<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test ethers.js Loading</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body {
            font-family: monospace;
            padding: 50px;
            max-width: 800px;
            margin: 0 auto;
        }
        .success {
            color: green;
            padding: 10px;
            background: #e8f5e9;
            border-left: 4px solid green;
            margin: 10px 0;
        }
        .error {
            color: red;
            padding: 10px;
            background: #ffebee;
            border-left: 4px solid red;
            margin: 10px 0;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ ethers.js Test Page</h1>
    <p>This page tests if ethers.js is loading correctly.</p>

    <div id="results"></div>

    <script>
        const resultsDiv = document.getElementById('results');

        function addResult(message, isSuccess) {
            const div = document.createElement('div');
            div.className = isSuccess ? 'success' : 'error';
            div.innerHTML = message;
            resultsDiv.appendChild(div);
        }

        function addCode(title, content) {
            const h3 = document.createElement('h3');
            h3.textContent = title;
            resultsDiv.appendChild(h3);

            const pre = document.createElement('pre');
            pre.textContent = content;
            resultsDiv.appendChild(pre);
        }

        // Test 1: Check if ethers exists
        if (typeof ethers === 'undefined') {
            addResult('‚ùå FAILED: ethers is not defined. CDN may not be loading.', false);
        } else {
            addResult('‚úÖ SUCCESS: ethers.js is loaded!', true);
            addCode('ethers.version', ethers.version);
        }

        // Test 2: Try to create a provider
        try {
            const provider = new ethers.providers.JsonRpcProvider('https://rpc.sepolia-api.lisk.com');
            addResult('‚úÖ SUCCESS: Created JsonRpcProvider', true);
            addCode('Provider', JSON.stringify({
                network: 'Lisk Sepolia',
                rpcUrl: 'https://rpc.sepolia-api.lisk.com'
            }, null, 2));
        } catch (error) {
            addResult('‚ùå FAILED: Could not create provider: ' + error.message, false);
        }

        // Test 3: Try to check address validation
        try {
            const isValid = ethers.utils.isAddress('0xbCa99c484Ca08B7c5FDaC58e2505a08595955B8F');
            addResult('‚úÖ SUCCESS: Address validation works', true);
            addCode('Test Address Validation', `
Factory Address: 0xbCa99c484Ca08B7c5FDaC58e2505a08595955B8F
Is Valid: ${isValid}
            `.trim());
        } catch (error) {
            addResult('‚ùå FAILED: Address validation error: ' + error.message, false);
        }

        // Test 4: Try to format ether
        try {
            const formatted = ethers.utils.formatEther('1000000000000000000');
            addResult('‚úÖ SUCCESS: Utils work correctly', true);
            addCode('Format Ether Test', `
Wei: 1000000000000000000
Ether: ${formatted}
            `.trim());
        } catch (error) {
            addResult('‚ùå FAILED: Utils error: ' + error.message, false);
        }

        // Test 5: Check MetaMask
        if (typeof window.ethereum !== 'undefined') {
            addResult('‚úÖ SUCCESS: MetaMask detected', true);
            addCode('MetaMask', JSON.stringify({
                isMetaMask: window.ethereum.isMetaMask,
                chainId: window.ethereum.chainId
            }, null, 2));
        } else {
            addResult('‚ö†Ô∏è  WARNING: MetaMask not detected. Install MetaMask to continue.', false);
        }

        // Final summary
        setTimeout(() => {
            const h2 = document.createElement('h2');
            h2.textContent = 'üìä Summary';
            resultsDiv.appendChild(h2);

            const successCount = document.querySelectorAll('.success').length;
            const errorCount = document.querySelectorAll('.error').length;

            const summary = document.createElement('div');
            summary.style.cssText = 'padding: 20px; background: #f5f5f5; border-radius: 5px; margin-top: 20px;';
            summary.innerHTML = `
                <strong>Tests Passed:</strong> ${successCount}<br>
                <strong>Tests Failed:</strong> ${errorCount}<br><br>
                ${errorCount === 0 ? 'üéâ All tests passed! The main demo should work.' : '‚ùå Some tests failed. Check the errors above.'}
            `;
            resultsDiv.appendChild(summary);

            if (errorCount === 0) {
                const link = document.createElement('p');
                link.innerHTML = '<a href="simple-frontend.html" style="display: inline-block; padding: 15px 30px; background: #4CAF50; color: white; text-decoration: none; border-radius: 5px; margin-top: 20px;">Go to Main Demo ‚Üí</a>';
                resultsDiv.appendChild(link);
            }
        }, 100);
    </script>
</body>
</html>
